-----CÂU 1-----
CREATE TABLE MONHOC (
MAMON CHAR(5) PRIMARY KEY,
TENMON NVARCHAR(20),
SOTC INT
);
GO
CREATE TABLE SINHVIEN (
MASV CHAR(5) PRIMARY KEY,
HOTEN NVARCHAR(30),
NGAYSINH SMALLDATETIME
);
GO
CREATE TABLE DIEM (
MASV CHAR(5),
MAMON CHAR(5),
DIEMTHI FLOAT,
CONSTRAINT FK_MASV FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV),
CONSTRAINT FK_MAMON FOREIGN KEY(MAMON) REFERENCES MONHOC(MAMON),
CONSTRAINT PK_MASV_MAMON PRIMARY KEY(MASV, MAMON))
GO
INSERT MONHOC VALUES
('01' , 'HQTCSDL' , 3),
('02' , 'CSDLNC' , 3),
('03' , 'CNJV' , 3)
INSERT SINHVIEN VALUES
('001' , 'NGUYỄN HOÀI NAM' , '20-10-2002'),
('002' , 'TRẦN NGUYỄN BÁ KHANG' , '09-10-2000'),
('003' , 'NGUYỄN LÊ KHÁNH AN' , '06-05-2000')
INSERT DIEM VALUES
('001' , '01' , 8.0),
('001' , '02' , 7.2),
('002' , '01' , 7.5),
('002' , '03' , 7.0),
('003' , '02' , 7.1)
GO
SELECT * FROM MONHOC
GO
SELECT * FROM DIEM
GO
SELECT * FROM SINHVIEN

-----CÂU 2-----
GO
CREATE FUNCTION TKSV (@TENMON NVARCHAR(20))
RETURNS INT
AS
BEGIN
DECLARE @DEM INT
SET @DEM = (SELECT COUNT(*) FROM DIEM WHERE @DEM < 5)
RETURN @DEM
END
GO 
SELECT dbo.TKSV('HQTCSDL')

-----CÂU 3-----
GO
CREATE PROCEDURE DIEM(@MASV CHAR(5) , @MAMON CHAR(5) , @DIEMTHI FLOAT)
AS
INSERT INTO DIEM(MASV , MAMON , DIEMTHI) VALUES (@MASV , @MAMON , @DIEMTHI)
GO
DIEM '001' , '01' , 8.0

-----CÂU 4-----
GO
CREATE TRIGGER THEM_SUA ON DIEM
FOR INSERT , UPDATE
AS
IF (SELECT DIEMTHI FROM INSERTED) > 10 AND (SELECT DIEMTHI FROM INSERTED) < 0
BEGIN
PRINT'Không cho phép cập nhật'
ROLLBACK TRANSACTION
END
INSERT INTO DIEM
VALUES ('001' , '02' , 5.0)